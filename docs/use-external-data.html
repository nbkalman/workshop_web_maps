<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Use External Data | Building Web Maps with Leaflet</title>
  <meta name="description" content="6 Use External Data | Building Web Maps with Leaflet" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Use External Data | Building Web Maps with Leaflet" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_web_maps" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Use External Data | Building Web Maps with Leaflet" />
  
  
  

<meta name="author" content="Dr. Michele Tobias" />
<meta name="author" content="Arthur Koehl" />
<meta name="author" content="Naomi Kalman" />


<meta name="date" content="2023-04-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="add-a-map.html"/>
<link rel="next" href="add-a-popup.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>




</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Building Web Maps with Leaflet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#description"><i class="fa fa-check"></i><b>0.1</b> Description</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i><b>0.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#skills"><i class="fa fa-check"></i><b>0.3</b> Skills</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>0.4</b> Prerequisites</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#software-tools"><i class="fa fa-check"></i><b>0.5</b> Software &amp; Tools</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-a-web-map"><i class="fa fa-check"></i><b>1.1</b> What is a “Web Map”?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#why-make-a-web-map"><i class="fa fa-check"></i><b>1.2</b> Why make a web map?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#examples"><i class="fa fa-check"></i><b>1.3</b> Examples</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#workflow"><i class="fa fa-check"></i><b>1.4</b> Workflow</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#leaflet"><i class="fa fa-check"></i><b>1.5</b> Leaflet</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction.html"><a href="introduction.html#other-web-map-tools"><i class="fa fa-check"></i><b>1.5.1</b> Other Web Map Tools</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#workshop-data-uc-davis-campus-food"><i class="fa fa-check"></i><b>1.6</b> Workshop Data: UC Davis Campus Food</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>2</b> Set Up</a>
<ul>
<li class="chapter" data-level="2.1" data-path="set-up.html"><a href="set-up.html#download-the-data"><i class="fa fa-check"></i><b>2.1</b> Download the Data</a></li>
<li class="chapter" data-level="2.2" data-path="set-up.html"><a href="set-up.html#folders"><i class="fa fa-check"></i><b>2.2</b> Folders</a></li>
<li class="chapter" data-level="2.3" data-path="set-up.html"><a href="set-up.html#files"><i class="fa fa-check"></i><b>2.3</b> Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="build-a-webpage.html"><a href="build-a-webpage.html"><i class="fa fa-check"></i><b>3</b> Build a Webpage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="build-a-webpage.html"><a href="build-a-webpage.html#intro-to-html"><i class="fa fa-check"></i><b>3.1</b> Intro to HTML</a></li>
<li class="chapter" data-level="3.2" data-path="build-a-webpage.html"><a href="build-a-webpage.html#start-building-your-webpage"><i class="fa fa-check"></i><b>3.2</b> Start Building your Webpage</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prepare-your-page-for-a-leaflet-web-map.html"><a href="prepare-your-page-for-a-leaflet-web-map.html"><i class="fa fa-check"></i><b>4</b> Prepare Your Page for a Leaflet Web Map</a>
<ul>
<li class="chapter" data-level="4.1" data-path="prepare-your-page-for-a-leaflet-web-map.html"><a href="prepare-your-page-for-a-leaflet-web-map.html#load-the-external-files"><i class="fa fa-check"></i><b>4.1</b> Load The External Files</a></li>
<li class="chapter" data-level="4.2" data-path="prepare-your-page-for-a-leaflet-web-map.html"><a href="prepare-your-page-for-a-leaflet-web-map.html#add-a-map-div"><i class="fa fa-check"></i><b>4.2</b> Add a Map Div</a></li>
<li class="chapter" data-level="4.3" data-path="prepare-your-page-for-a-leaflet-web-map.html"><a href="prepare-your-page-for-a-leaflet-web-map.html#add-a-script-section"><i class="fa fa-check"></i><b>4.3</b> Add a Script Section</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="add-a-map.html"><a href="add-a-map.html"><i class="fa fa-check"></i><b>5</b> Add a Map</a>
<ul>
<li class="chapter" data-level="5.1" data-path="add-a-map.html"><a href="add-a-map.html#add-a-map-1"><i class="fa fa-check"></i><b>5.1</b> Add A Map</a></li>
<li class="chapter" data-level="5.2" data-path="add-a-map.html"><a href="add-a-map.html#add-a-marker"><i class="fa fa-check"></i><b>5.2</b> Add a Marker</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="use-external-data.html"><a href="use-external-data.html"><i class="fa fa-check"></i><b>6</b> Use External Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="use-external-data.html"><a href="use-external-data.html#about-geojson"><i class="fa fa-check"></i><b>6.1</b> About GeoJSON</a></li>
<li class="chapter" data-level="6.2" data-path="use-external-data.html"><a href="use-external-data.html#formatting-the-data"><i class="fa fa-check"></i><b>6.2</b> Formatting the Data</a></li>
<li class="chapter" data-level="6.3" data-path="use-external-data.html"><a href="use-external-data.html#read-the-data"><i class="fa fa-check"></i><b>6.3</b> Read the Data</a></li>
<li class="chapter" data-level="6.4" data-path="use-external-data.html"><a href="use-external-data.html#add-data-to-the-map"><i class="fa fa-check"></i><b>6.4</b> Add Data to the Map</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="add-a-popup.html"><a href="add-a-popup.html"><i class="fa fa-check"></i><b>7</b> Add a popup</a>
<ul>
<li class="chapter" data-level="7.1" data-path="add-a-popup.html"><a href="add-a-popup.html#add-a-popup-1"><i class="fa fa-check"></i><b>7.1</b> Add a popup</a></li>
<li class="chapter" data-level="7.2" data-path="add-a-popup.html"><a href="add-a-popup.html#customize-popup-text-with-data"><i class="fa fa-check"></i><b>7.2</b> Customize Popup Text with Data</a></li>
<li class="chapter" data-level="7.3" data-path="add-a-popup.html"><a href="add-a-popup.html#add-details-to-the-popup-text"><i class="fa fa-check"></i><b>7.3</b> Add details to the popup text</a></li>
<li class="chapter" data-level="7.4" data-path="add-a-popup.html"><a href="add-a-popup.html#add-a-description-to-the-popup"><i class="fa fa-check"></i><b>7.4</b> Add a description to the popup</a></li>
<li class="chapter" data-level="7.5" data-path="add-a-popup.html"><a href="add-a-popup.html#add-an-image-to-the-popup"><i class="fa fa-check"></i><b>7.5</b> Add an image to the popup</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="put-your-web-page-online.html"><a href="put-your-web-page-online.html"><i class="fa fa-check"></i><b>8</b> Put Your Web Page online</a></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building Web Maps with Leaflet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="use-external-data" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Use External Data<a href="use-external-data.html#use-external-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>START FROM HERE:</strong> You can keep working on your code from the previous section, or use the <a href="https://github.com/ucdavisdatalab/workshop_web_maps/blob/main/example_code/end_of_sec_5.html">example code up to this point in the workshop</a>.</p>
<p>Adding markers by hand is great, but what if we have a lot of data? Or what if our data is more complex than a few points to add? What if we want to prepare our data in a GIS or with a script ahead of time? If any of these situations apply to the work we want to do, we probably want to load data from a data file, not writing it out in the code.</p>
<p>There are many methods to load an external data file in Leaflet. We’ll look at just one here, but there are ways to work with any of the common file types. Here, we’ll use data in geoJSON format.</p>
<div id="about-geojson" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> About GeoJSON<a href="use-external-data.html#about-geojson" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>GeoJSON is a spatial data format based on the JSON format. Both JSON and GeoJSON are open standard file formats that text-based (not binary). They store data as attribute-value pairs, such as <code>"Name": "Bob"</code> in our example below. You might think of this as the files storing the column name and the value for that column for a row in the table. Because they are text-based, they are human-readable (however, depending on the complexity of the data, you may not want to try to read it in a text editor). Another advantage of using a text-based format is that it can easily be stored in online version control systems like GitHub, as long as a file size isn’t too big. This is a nice feature if you want to host your webmap on <a href="https://pages.github.com/">GitHub Pages</a>.</p>
<p>Any of the major GIS tools or programming languages can convert vector data to GeoJSON format.</p>
<p>The header and first line of our Campus Food data looks something like this in GeoJSON (we removed the link URLs and added white space and indents for readability):</p>
<pre><code>&quot;type&quot;: &quot;FeatureCollection&quot;,
&quot;name&quot;: &quot;campus_food&quot;,
&quot;crs&quot;: { &quot;type&quot;: &quot;name&quot;, &quot;properties&quot;: { &quot;name&quot;: &quot;urn:ogc:def:crs:OGC:1.3:CRS84&quot; } },


&quot;features&quot;: [
  { 
  &quot;type&quot;: &quot;Feature&quot;, 
  &quot;properties&quot;: { 
    &quot;Name&quot;: &quot;CoHo Grab and Go&quot;, 
    &quot;description&quot;: &quot;Grapes, cheese, yogurt, sandwiches, etc. in a refrigerated case by the drinks&quot;,
    &quot;gx_media_links&quot;: &quot;(URL goes here)&quot;, 
    &quot;img_name&quot;: &quot;coho.jpg&quot; }, 
  &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ -121.7497985, 38.5421103, 0.0 ] } 
  }
</code></pre>
</div>
<div id="formatting-the-data" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Formatting the Data<a href="use-external-data.html#formatting-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the sake of time in this workshop, we’ve already formatted the data for you, but let’s talk about what we did.</p>
<p>Leaflet can’t read GeoJSON directly, but we can turn the data file into a javascript (.js) file that Leaflet can understand. All we have to do is open the .geojson file in a text editor, add <code>var varable-name = {</code> at the beginning of the file, and <code>}</code> at the end of the file (we’re “wrapping” the data in a variable declaration). Then we save the file with a .js extension (because what we’ve actually done is written a small JavaScript file). We now have a javascript file that reads data from the GeoJSON text and creates a new variable containing our data.</p>
<p><strong>We’ve done this for you</strong> to create the <code>campus_food.js</code> file, declaring our variable as <code>campus_food</code>. You can see the GeoJSON structure and the variable declaration if you open the file in a text editor.</p>
</div>
<div id="read-the-data" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Read the Data<a href="use-external-data.html#read-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To read the data into our webpage, we need to add another short script section, just above the one we’ve been working in that calls our <code>campus_food.js</code> data file.</p>
<pre><code>&lt;body&gt;
&lt;h1&gt;UC Davis Campus Food Map&lt;/h1&gt;
&lt;p&gt;This webmap shows the locations of UC Davis campus grab-and-go dining options.&lt;/p&gt;

&lt;div id=&quot;mapid&quot; style=&quot;width: 600px; height: 400px;&quot;&gt;&lt;/div&gt;

&lt;highlight&gt;&lt;script src=&quot;campus_food.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&lt;/highlight&gt;

&lt;script&gt;</code></pre>
<p>Now the data in this file will be available to load into our map.</p>
<p><strong>NOTE:</strong> You could put this script in the <code>&lt;head&gt;</code> of the document where we loaded the Leaflet and CSS scripts. I like to keep all the map code together for teaching purposes (less scrolling around). Both are valid and work the same.</p>
</div>
<div id="add-data-to-the-map" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Add Data to the Map<a href="use-external-data.html#add-data-to-the-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is the moment you’ve been waiting for! We’ll add data from our external data file to the map.</p>
<p>Add this code to the bottom of your long script section (below where we made our marker for the Quad and above the closing <code>&lt;/script&gt;</code> tag):</p>
<pre><code>    &lt;highlight&gt;
    //add food points from the GeoJSON (campus_food.js) file

    var foodpoints = L.geoJSON(campus_food, {  
        pointToLayer: function(feature, latlng){  
            return L.circleMarker(latlng, {color: &#39;orange&#39;, radius: 8});
        }
    }).addTo(foodmap);
    &lt;/highlight&gt;
    
&lt;/script&gt;</code></pre>
<p>We now have many orange circles for our dining spots (and one for the quad that we added earlier)!</p>
<p><img src="images/webpage_section_6-4.png" title="Web map with orange circles for grab-and-go locations and a blue marker for the quad" /></p>
<p>What does this code do though?</p>
<p>First, we create a variable called <em>foodpoints</em> using the geojson data which we named <em>campus_food</em> inside the .js file. Then we create a function called <code>pointToLayer</code> that uses the parameters <em>feature</em> (each row in the data) and <em>latlng</em> (the geometry) from the geojson data. We make a <em>circleMarker</em> using the <em>latlng</em> variable for the position, and use the style options between the {}s to style the marker the way we want it. In this case, it’s orange and has a radius of 8 (which is a little smaller than the default). Finally, we add the entire set of markers we built to the map (remember that we called our div that holds our map <em>foodmap</em>).</p>
<p><strong>CHECK YOUR WORK:</strong> Compare your code with <a href="https://github.com/ucdavisdatalab/workshop_web_maps/blob/main/example_code/end_of_sec_6.html">example code up to this point in the workshop</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="add-a-map.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="add-a-popup.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_web_maps/edit/master/06_use_external_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_web_maps/blob/master/06_use_external_data.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
